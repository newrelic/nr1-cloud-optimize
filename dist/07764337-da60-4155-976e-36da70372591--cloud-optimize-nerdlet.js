var __NR_MODULES="object"==typeof __NR_MODULES?__NR_MODULES:{};__NR_MODULES["07764337-da60-4155-976e-36da70372591--cloud-optimize-nerdlet"]=function(e){function t(t){for(var a,s,o=t[0],l=t[1],c=t[2],p=0,m=[];p<o.length;p++)s=o[p],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&m.push(r[s][0]),r[s]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);for(u&&u(t);m.length;)m.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],a=!0,o=1;o<n.length;o++){var l=n[o];0!==r[l]&&(a=!1)}a&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var a={},r={0:0},i=[];function s(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=a,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(n,a,function(t){return e[t]}.bind(null,a));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var o=window["webpackJsonp__07764337-da60-4155-976e-36da70372591"]=window["webpackJsonp__07764337-da60-4155-976e-36da70372591"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var u=l;return i.push([439,1]),n()}({0:function(e,t){e.exports=React},428:function(e){e.exports=JSON.parse('{"US East (Ohio)":"us-east-2","US East (N. Virginia)":"us-east-1","US West (N. California)":"us-west-1","US West (Oregon)":"us-west-2","Asia Pacific (Mumbai)":"ap-south-1","Asia Pacific (Osaka-Local)":"ap-northeast-3","Asia Pacific (Seoul)":"ap-northeast-2","Asia Pacific (Singapore)":"ap-southeast-1","Asia Pacific (Sydney)":"ap-southeast-2","Asia Pacific (Tokyo)":"ap-northeast-1","Canada (Central)":"ca-central-1","China (Beijing)":"cn-north-1","China (Ningxia)":"cn-northwest-1","EU (Frankfurt)":"eu-central-1","EU (Ireland)":"eu-west-1","EU (London)":"eu-west-2","EU (Paris)":"eu-west-3","EU (Stockholm)":"eu-north-1","South America (São Paulo)":"sa-east-1","AWS GovCloud (US-East)":"us-gov-east-1","AWS GovCloud (US)":"us-gov-west-1"}')},438:function(e,t,n){e.exports={getTimeRange:function(e){var t=e.launcher.state.timeRange;return t?t.begin_time&&t.end_time?" SINCE ".concat(t.begin_time," UNTIL ").concat(t.end_time):t.duration?" SINCE ".concat(t.duration/1e3," SECONDS AGO"):"":""},determineAwsInstance:function(e,t,a){var r=n(43),i=a.numCpu*e.rightSizeCpu,s=a.memGB*e.rightSizeMem,o=[];if(a.timeSinceLastReported>36e5*parseFloat(e.lastReportPeriod))return null;var l=!1,c=!1,u=!1,p=!1,m=!1,d=!1,h=!1,g=!1;if(e.staleInstanceCpu>0&&(c=!0,a.maxCpuPercent<=e.staleInstanceCpu&&(l=!0)),e.staleInstanceMem>0&&(p=!0,a.maxMemoryPercent<=e.staleInstanceMem&&(u=!0)),e.staleReceiveBytesPerSecond>0&&(d=!0,a.receiveBytesPerSecond<=e.staleReceiveBytesPerSecond&&(m=!0)),e.staleTransmitBytesPerSecond>0&&(g=!0,a.transmitBytesPerSecond<=e.staleTransmitBytesPerSecond&&(h=!0)),c==l&&p==u&&d==m&&g==h)return o.push({price:0,instanceType:"stale",suggestion:"stale",strategy:"cost"}),{cheapest:o[0],suggested:o[0],all:o};function f(e,t){for(var n=0;n<e.length;n++)if(t.includes(e[n]))return!0;return!1}if(t&&t.prices){var y=t.prices,v={},E={},C={},S={};y=r.orderBy(y,[function(e){return e.price.USD}],["asc","desc"]);for(var w=0;w<y.length;w++)if(a.operatingSystem==y[w].attributes["aws:ec2:operatingSystem"].toLowerCase()&&!f(e.instanceOptionsCurrent,y[w].attributes["aws:ec2:instanceType"]))if(y[w].attributes["aws:ec2:vcpu"]!=i||parseFloat(y[w].attributes["aws:ec2:memory"])!=s||"on-demand"!=y[w].attributes["aws:ec2:term"]||v[y[w].attributes["aws:ec2:instanceFamily"]])if(y[w].attributes["aws:ec2:vcpu"]>i&&parseFloat(y[w].attributes["aws:ec2:memory"])==s&&"on-demand"==y[w].attributes["aws:ec2:term"]&&!E[y[w].attributes["aws:ec2:instanceFamily"]]){var b={price:parseFloat(y[w].price.USD).toFixed(2),instanceType:y[w].attributes["aws:ec2:instanceType"],instanceFamily:y[w].attributes["aws:ec2:instanceFamily"],vcpu:y[w].attributes["aws:ec2:vcpu"],ecu:y[w].attributes["aws:ec2:ecu"],memory:y[w].attributes["aws:ec2:memory"],strategy:"cost"};E[y[w].attributes["aws:ec2:instanceFamily"]]=b,o.push(b)}else if(y[w].attributes["aws:ec2:vcpu"]==i&&parseFloat(y[w].attributes["aws:ec2:memory"])>s&&"on-demand"==y[w].attributes["aws:ec2:term"]&&!C[y[w].attributes["aws:ec2:instanceFamily"]]){var x={price:parseFloat(y[w].price.USD).toFixed(2),instanceType:y[w].attributes["aws:ec2:instanceType"],instanceFamily:y[w].attributes["aws:ec2:instanceFamily"],vcpu:y[w].attributes["aws:ec2:vcpu"],ecu:y[w].attributes["aws:ec2:ecu"],memory:y[w].attributes["aws:ec2:memory"],strategy:"cost"};C[y[w].attributes["aws:ec2:instanceFamily"]]=x,o.push(x)}else if(y[w].attributes["aws:ec2:vcpu"]>i&&parseFloat(y[w].attributes["aws:ec2:memory"])>s&&"on-demand"==y[w].attributes["aws:ec2:term"]&&!S[y[w].attributes["aws:ec2:instanceFamily"]]){var P={price:parseFloat(y[w].price.USD).toFixed(2),instanceType:y[w].attributes["aws:ec2:instanceType"],instanceFamily:y[w].attributes["aws:ec2:instanceFamily"],vcpu:y[w].attributes["aws:ec2:vcpu"],ecu:y[w].attributes["aws:ec2:ecu"],memory:y[w].attributes["aws:ec2:memory"],strategy:"cost"};S[y[w].attributes["aws:ec2:instanceFamily"]]=P,o.push(P)}else;else{var O={price:parseFloat(y[w].price.USD).toFixed(2),instanceType:y[w].attributes["aws:ec2:instanceType"],instanceFamily:y[w].attributes["aws:ec2:instanceFamily"],vcpu:y[w].attributes["aws:ec2:vcpu"],ecu:y[w].attributes["aws:ec2:ecu"],memory:y[w].attributes["aws:ec2:memory"],strategy:"cost"};v[y[w].attributes["aws:ec2:instanceFamily"]]=O,o.push(O)}if(o.length>0){var z={cheapest:o[0],suggested:o[0],all:o};if(a.maxCpuPercent>=e.optimizeBy){for(var k=0;k<o.length;k++)if(o[k].instanceFamily.includes("Compute")){z.suggested=o[k];break}}else if(a.maxMemoryPercent>=e.optimizeBy)for(var T=0;T<o.length;T++)if(o[T].instanceFamily.includes("Memory")){z.suggested=o[T];break}return z}return null}}}},439:function(e,t,n){"use strict";n.r(t);var a=n(15),r=n.n(a),i=n(28),s=n.n(i),o=n(21),l=n.n(o),c=n(22),u=n.n(c),p=n(23),m=n.n(p),d=n(24),h=n.n(d),g=n(30),f=n.n(g),y=n(25),v=n.n(y),E=n(38),C=n.n(E),S=n(0),w=n.n(S),b=n(6),x=n.n(b),P=n(44),O=n(147),z=n.n(O),k=n(148),T=n.n(k);function B(){var e=z()(["{\n    actor {\n      account(id: ",") {\n        system: nrql(query: \"FROM SystemSample SELECT  latest(timestamp) as 'timestamp', latest(providerAccountName) as 'providerAccountName', latest(coreCount) as 'numCpu', latest(memoryTotalBytes) as 'memTotalBytes', latest(operatingSystem) as 'operatingSystem', latest(ec2InstanceType) as 'ec2InstanceType', max(cpuPercent) as 'maxCpuPercent', max(memoryUsedBytes/memoryTotalBytes)*100 as 'maxMemoryPercent', latest(instanceType) as 'instanceType', latest(ec2InstanceType) as 'ec2InstanceType', latest(ec2InstanceId) as 'ec2InstanceId' FACET hostname, apmApplicationNames, entityGuid, awsRegion WHERE coreCount is not null and (instanceType is not null OR ec2InstanceType is not null) limit 2000 since 1 week ago\", timeout: 30000) {\n          results\n        }\n        network: nrql(query: \"FROM NetworkSample SELECT latest(timestamp) as 'timestamp', max(receiveBytesPerSecond) as 'receiveBytesPerSecond', max(transmitBytesPerSecond) as 'transmitBytesPerSecond' FACET hostname, entityGuid, awsRegion, instanceType WHERE (instanceType is not null OR ec2InstanceType is not null) limit 2000 since 1 week ago\", timeout: 30000) {\n          results\n        }\n      }\n    }\n  }"]);return B=function(){return e},e}function I(){var e=z()(["{\n  actor {\n    accounts {\n      id\n      name\n    }\n  }\n}"]);return I=function(){return e},e}var F=function(){var e=s()(r.a.mark(function e(t){var n,a;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.UserStorageQuery.query({collection:t});case 2:return n=e.sent,a=((((n||{}).data||{}).actor||{}).nerdStorage||{}).collection||[],e.abrupt("return",a);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),R=function(){var e=s()(r.a.mark(function e(t,n,a){var i;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.UserStorageMutation.mutate({actionType:P.UserStorageMutation.ACTION_TYPE.WRITE_DOCUMENT,collection:t,documentId:n,document:a});case 2:return i=e.sent,e.abrupt("return",i);case 4:case"end":return e.stop()}},e)}));return function(t,n,a){return e.apply(this,arguments)}}(),A=function(){var e=s()(r.a.mark(function e(t,n){var a;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.UserStorageMutation.mutate({actionType:P.UserStorageMutation.ACTION_TYPE.DELETE_DOCUMENT,collection:t,documentId:n});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),D=T()(I()),M=n(457),N=n(453),H=n(85),j=n.n(H),_=n(451),L=n(60),U=n(450),$=n(448),G=n(449),W=function(e){function t(e){var n;return l()(this,t),n=m()(this,h()(t).call(this,e)),C()(f()(n),"handleAddition",function(e,t){var a=t.value,r=n.props.config;r.instanceOptions=[{text:a,value:a}].concat(j()(n.props.config.instanceOptions)),n.props.handleParentState("config",r)}),C()(f()(n),"handleChange",function(e,t){var a=t.value,r=n.props.config;r.instanceOptionsCurrent=a,n.props.handleParentState("config",r,"groupAndSortRecalc")}),n.handleConfigurator=n.handleConfigurator.bind(f()(n)),n}return v()(t,e),u()(t,[{key:"handleConfigurator",value:function(e,t,n){var a=this.props.config;isNaN(t.value)?(a[n]=n.includes("stale")?0:1,this.props.handleParentState("config",a,"groupAndSortRecalc")):(a[n]=t.value,this.props.handleParentState("config",a,"groupAndSortRecalc"))}},{key:"render",value:function(){var e=this;return w.a.createElement(_.a,{size:"small",trigger:w.a.createElement(M.a.Item,null,"Configuration  ",w.a.createElement(L.a,{name:"cog"}))},w.a.createElement(_.a.Header,null,"Advanced Configuration"),w.a.createElement(_.a.Content,{style:{backgroundColor:"black"}},w.a.createElement(U.a,{inverted:!0},w.a.createElement(U.a.Field,{inline:!0},w.a.createElement("label",{style:{width:"230px"}},"Inclusion Period (hours)"),w.a.createElement($.a,{inverted:!0,value:this.props.config.lastReportPeriod,onChange:function(t,n){e.handleConfigurator(t,n,"lastReportPeriod")}})),w.a.createElement("label",null,"Instance needs to have reported at least once within this period."),w.a.createElement(G.a,null),w.a.createElement(U.a.Field,{inline:!0},w.a.createElement("label",{style:{width:"230px"}},"Discount Multiplier"),w.a.createElement($.a,{inverted:!0,value:this.props.config.discountMultiplier,onChange:function(t,n){e.handleConfigurator(t,n,"discountMultiplier")}})),w.a.createElement("label",null,"Factor any discounts in such as EDP, eg. 0.9 equals 10% discount."),w.a.createElement(G.a,null),w.a.createElement(U.a.Field,{inline:!0},w.a.createElement("label",{style:{width:"230px"}},"Stale Instance CPU %"),w.a.createElement($.a,{inverted:!0,value:this.props.config.staleInstanceCpu,onChange:function(t,n){e.handleConfigurator(t,n,"staleInstanceCpu")}})),w.a.createElement(U.a.Field,{inline:!0},w.a.createElement("label",{style:{width:"230px"}},"Stale Instance Memory %"),w.a.createElement($.a,{inverted:!0,value:this.props.config.staleInstanceMem,onChange:function(t,n){e.handleConfigurator(t,n,"staleInstanceMem")}})),w.a.createElement(U.a.Field,{inline:!0},w.a.createElement("label",{style:{width:"230px"}},"Stale Transmit Bytes/s"),w.a.createElement($.a,{inverted:!0,value:this.props.config.staleTransmitBytesPerSecond,onChange:function(t,n){e.handleConfigurator(t,n,"staleTransmitBytesPerSecond")}})),w.a.createElement(U.a.Field,{inline:!0},w.a.createElement("label",{style:{width:"230px"}},"Stale Receive Bytes/s"),w.a.createElement($.a,{inverted:!0,value:this.props.config.staleReceiveBytesPerSecond,onChange:function(t,n){e.handleConfigurator(t,n,"staleReceiveBytesPerSecond")}})),w.a.createElement("label",null,"Automatically class instances as stale using max values. Anything set to 0 will disable the stale check."),w.a.createElement(G.a,null),w.a.createElement(U.a.Field,null,w.a.createElement("label",{style:{width:"230px"}},"Instance Type Filter"),w.a.createElement(N.a,{options:this.props.config.instanceOptions,placeholder:"",search:!0,selection:!0,fluid:!0,multiple:!0,allowAdditions:!0,value:this.props.config.instanceOptionsCurrent,onAddItem:this.handleAddition,onChange:this.handleChange})),w.a.createElement("label",null,'Filter instance types out, eg. "t2".'),w.a.createElement(G.a,null),w.a.createElement(U.a.Field,{inline:!0},w.a.createElement("label",{style:{width:"230px"}},"Right Size CPU %"),w.a.createElement($.a,{inverted:!0,value:this.props.config.rightSizeCpu,onChange:function(t,n){e.handleConfigurator(t,n,"rightSizeCpu")}})),w.a.createElement(U.a.Field,{inline:!0},w.a.createElement("label",{style:{width:"230px"}},"Right Size Memory %"),w.a.createElement($.a,{inverted:!0,value:this.props.config.rightSizeMem,onChange:function(t,n){e.handleConfigurator(t,n,"rightSizeMem")}})),w.a.createElement("label",null,"The instance(s) that get dynamically selected for right sizing can be tuned here."))))}}]),t}(w.a.Component),q=n(454),V=n(440),J=function(e){function t(e){var n;return l()(this,t),(n=m()(this,h()(t).call(this,e))).deleteSnapshot=n.deleteSnapshot.bind(f()(n)),n}var n;return v()(t,e),u()(t,[{key:"deleteSnapshot",value:(n=s()(r.a.mark(function e(t){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A("cloudOptimizeSnapshotsX","ss_".concat(t));case 2:this.props.fetchSnapshots();case 3:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"render",value:function(){var e=this,t=this.props.data,n=t.t?new Date(t.t).toString().split(" ").filter(function(e,t){return t<5&&t>0}).join(" "):"",a=(new Date).toString().split(" ").filter(function(e,t){return t<5&&t>0}).join(" ");return w.a.createElement(q.a,{color:"black",celled:!0,inverted:!0,style:{width:"400px",minWidth:"400px",margin:"5px",overflowX:"auto"}},w.a.createElement(q.a.Header,null,w.a.createElement(q.a.Row,null,w.a.createElement(q.a.HeaderCell,null,n||w.a.createElement("span",null,"Current State")),w.a.createElement(q.a.HeaderCell,null,"Monthly"),w.a.createElement(q.a.HeaderCell,null,"Yearly"))),w.a.createElement(q.a.Body,null,w.a.createElement(q.a.Row,null,w.a.createElement(q.a.Cell,null,"Non-Optimized"),w.a.createElement(q.a.Cell,null,"$",(720*(t.nonOptimizedCost||t.noc)).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")),w.a.createElement(q.a.Cell,null,"$",(720*(t.nonOptimizedCost||t.noc)*12).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,"))),w.a.createElement(q.a.Row,null,w.a.createElement(q.a.Cell,null,"Optimized"),w.a.createElement(q.a.Cell,null,"$",(720*(t.optimizedCost||t.oc)).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")),w.a.createElement(q.a.Cell,null,"$",(720*(t.optimizedCost||t.oc)*12).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,"))),w.a.createElement(q.a.Row,null,w.a.createElement(q.a.Cell,{positive:!0},"Saving"),w.a.createElement(q.a.Cell,{positive:!0},"$",(720*(t.saving||t.s)).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")),w.a.createElement(q.a.Cell,{positive:!0},"$",(720*(t.saving||t.s)*12).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")))),w.a.createElement(q.a.Footer,null,w.a.createElement(q.a.Row,null,w.a.createElement(q.a.HeaderCell,{style:{textAlign:"right"},colSpan:3},t.nonOptimizedCount||t.noi,"/",t.totalInstances||t.noi+t.oi," Instances to Optimize | ",t.nonOptimizedCost||t.noc>0?(Math.abs(t.saving||t.s)/(t.nonOptimizedCost||t.noc)*100).toFixed(2):0,"% Cost Saving ",w.a.createElement("br",null),t.t?w.a.createElement("span",null,w.a.createElement("br",null),w.a.createElement(V.a,{inverted:!0,size:"mini",content:"Delete Snapshot",onClick:function(){return e.deleteSnapshot(t.t)}})):w.a.createElement("span",null,w.a.createElement("br",null),a,w.a.createElement("br",null))))))}}]),t}(w.a.Component),Y=n(43),X=n.n(Y),Q=function(e){function t(){return l()(this,t),m()(this,h()(t).apply(this,arguments))}return v()(t,e),u()(t,[{key:"renderSnapshotList",value:function(e){var t=this;return X()(e).groupBy(function(e){return e.document.g}).map(function(e,t){return{group:t,data:e}}).value().map(function(e,n){return w.a.createElement("div",{key:n},w.a.createElement("h4",null,e.group),w.a.createElement("div",{style:{overflow:"scroll"}},w.a.createElement("div",{style:{display:"flex",fontSize:"11px"}},e.data.map(function(e,n){return w.a.createElement(J,{key:n,data:e.document,fetchSnapshots:t.props.fetchSnapshots,cloudOptimizeSnapshots:t.props.cloudOptimizeSnapshots})}))))})}},{key:"render",value:function(){return this.props.snapshots.length>0?w.a.createElement(_.a,{size:"fullscreen",trigger:w.a.createElement(M.a.Item,null,"View Snapshots (",this.props.snapshots.length,")  ",w.a.createElement(L.a,{name:"clone"}))},w.a.createElement(_.a.Header,null,"All Snapshots"),w.a.createElement(_.a.Content,{scrolling:!0,style:{backgroundColor:"black",color:"white"}},this.renderSnapshotList(this.props.snapshots))):w.a.createElement(M.a.Item,null,"No Snapshots  ",w.a.createElement(L.a,{name:"clone"}))}}]),t}(w.a.Component),K=n(428),Z=function(e){function t(e){var n;return l()(this,t),(n=m()(this,h()(t).call(this,e))).handleOptimize=n.handleOptimize.bind(f()(n)),n.handleDropdownChange=n.handleDropdownChange.bind(f()(n)),n}return v()(t,e),u()(t,[{key:"handleDropdownChange",value:function(e,t,n){var a=this.props.config;a[n]=t.value,"awsPricingRegion"==n?this.props.handleParentState("config",a,"groupAndSortRecalc"):this.props.handleParentState("config",a,"groupAndSort")}},{key:"handleOptimize",value:function(e){var t=this.props.config;t.optimizeBy=e.target.value,this.props.handleParentState("config",t,"groupAndSort")}},{key:"render",value:function(){var e=this,t=Object.keys(K).map(function(e){return{key:e,text:e,value:K[e]}});return w.a.createElement(M.a,{inverted:!0,style:{marginBottom:"0px",marginTop:"5px",textAlign:"center"}},w.a.createElement(M.a.Item,null,"Group By:"),w.a.createElement(N.a,{options:[{key:1,text:"NR Account",value:"accountName"},{key:2,text:"Cloud Account",value:"providerAccountName"},{key:3,text:"Applications",value:"apmApplicationNames"},{key:4,text:"AWS Instance Type",value:"awsInstanceType"},{key:5,text:"Suggested Instance Type",value:"suggestedInstanceType"},{key:6,text:"AWS Region",value:"awsRegion"}],simple:!0,item:!0,onChange:function(t,n){e.handleDropdownChange(t,n,"groupBy")},value:this.props.config.groupBy||"accountName"}),w.a.createElement(M.a.Item,null,this.props.instanceLength),w.a.createElement(M.a.Item,null,"Sort By:"),w.a.createElement(N.a,{options:[{key:1,text:"Saving Value",value:"saving"},{key:2,text:"Non Optimized Value",value:"nonOptimizedCost"},{key:3,text:"Non Optimized Count",value:"nonOptimizedCount"},{key:4,text:"Optimized Value",value:"optimizedCost"},{key:5,text:"Optimized Count",value:"optimizedCount"},{key:6,text:"Instance Count",value:"totalInstances"}],simple:!0,item:!0,onChange:function(t,n){e.handleDropdownChange(t,n,"sortBy")},value:this.props.config.sortBy||"nonOptimizedCost"}),w.a.createElement(M.a.Item,null,"Optimize By:"),w.a.createElement(M.a.Item,null,w.a.createElement("input",{type:"range",max:"75",step:"1",value:this.props.config.optimizeBy,onChange:this.handleOptimize,style:{width:"100%"}})),w.a.createElement(M.a.Item,null,this.props.config.optimizeBy),w.a.createElement(M.a.Menu,{position:"right"},w.a.createElement(Q,{snapshots:this.props.snapshots,cloudOptimizeSnapshots:this.props.cloudOptimizeSnapshots,fetchSnapshots:this.props.fetchSnapshots}),w.a.createElement(M.a.Item,null,"AWS Pricing Region:"),w.a.createElement(N.a,{options:t,simple:!0,item:!0,onChange:function(){var t=s()(r.a.mark(function t(n,a){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.props.fetchAwsPricing(a.value);case 2:e.handleDropdownChange(n,a,"awsPricingRegion");case 3:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}(),value:this.props.config.awsPricingRegion||"ap-southeast-2"}),w.a.createElement(W,{config:this.props.config,handleParentState:this.props.handleParentState})))}}]),t}(w.a.Component),ee=n(458),te=n(456),ne=n(452),ae=function(e){function t(){return l()(this,t),m()(this,h()(t).apply(this,arguments))}return v()(t,e),u()(t,[{key:"render",value:function(){return w.a.createElement(ee.a,{inverted:!0,style:{marginBottom:"0px",textAlign:"center"}},w.a.createElement(te.a,{inverted:!0,horizontal:!0,style:{marginBottom:"0px"}},w.a.createElement(ne.a,{content:"Estimated cost associated to EC2 Optimization Candidates before Right Sizing",trigger:w.a.createElement(te.a.Label,null,this.props.title,"      Non-Optimized   ")}),w.a.createElement(te.a.Value,null,"$",(this.props.totals.nonOptimizedCost*this.props.multiplier).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")),w.a.createElement(ne.a,{content:"New Estimated cost associated to EC2 Optimization Candidates after Right Sizing",trigger:w.a.createElement(te.a.Label,null,"Optimized   ")}),w.a.createElement(te.a.Value,null,"$",(this.props.totals.optimizedCost*this.props.multiplier).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")),w.a.createElement(ne.a,{content:"Savings based on difference between Non-Optimized & Optimized cost estimates",trigger:w.a.createElement(te.a.Label,null,"Potential Savings   ")}),w.a.createElement(te.a.Value,null,"$",(this.props.totals.saving*this.props.multiplier).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,"))),"    ")}}]),t}(w.a.Component);C()(ae,"propTypes",{totals:x.a.object.isRequired,multiplier:x.a.number.isRequired,title:x.a.string.isRequired});var re=n(455),ie=n(249),se=n.n(ie);function oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}var le=function(e){function t(e){var n;return l()(this,t),(n=m()(this,h()(t).call(this,e))).state={column:null,direction:null,modalInstanceData:[]},n}return v()(t,e),u()(t,[{key:"handleTableSort",value:function(e){this.state.column===e?this.setState({column:e,modalInstanceData:this.state.modalInstanceData.reverse(),direction:"ascending"===this.state.direction?"descending":"ascending"}):this.setState({column:e,modalInstanceData:X.a.sortBy(this.state.modalInstanceData,[e]),direction:"ascending"})}},{key:"renderSuggestionsModal",value:function(e,t){return w.a.createElement(_.a,{inverted:!0,trigger:w.a.createElement(V.a,{style:{width:"100%"},size:"mini",inverted:!0,content:w.a.createElement("span",null,e," ",w.a.createElement(L.a,{style:{float:"right"},name:"list alternate outline"}))})},w.a.createElement(_.a.Header,null,"Alternate Suggestions"),w.a.createElement(_.a.Content,{style:{backgroundColor:"black"}},w.a.createElement(q.a,{inverted:!0,striped:!0},w.a.createElement(q.a.Header,null,w.a.createElement(q.a.HeaderCell,null,"instanceType"),w.a.createElement(q.a.HeaderCell,null,"instanceFamily"),w.a.createElement(q.a.HeaderCell,null,"cpu"),w.a.createElement(q.a.HeaderCell,null,"mem"),w.a.createElement(q.a.HeaderCell,null,"price /m")),w.a.createElement(q.a.Body,null,t.map(function(e,t){return w.a.createElement(q.a.Row,{key:t},w.a.createElement(q.a.Cell,null,e.instanceType),w.a.createElement(q.a.Cell,null,e.instanceFamily),w.a.createElement(q.a.Cell,null,e.vcpu),w.a.createElement(q.a.Cell,null,e.memory),w.a.createElement(q.a.Cell,null,(720*e.price).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")))})))))}},{key:"render",value:function(){var e=this,t=j()(this.props.instances).filter(function(e){return e.suggestion||e.saving>0}).map(function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oe(n,!0).forEach(function(t){C()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oe(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e);delete t.suggestions,delete t.hostnameapmApplicationNamesentityGuidawsRegion;for(var n=0;n<Object.keys(t).length;n++)Array.isArray(t[Object.keys(t)[n]])&&delete t[Object.keys(t)[n]];return t});return w.a.createElement(_.a,{size:"fullscreen",trigger:w.a.createElement(V.a,{size:"mini",onClick:function(){return e.setState({modalInstanceData:e.props.instances,column:null,direction:null})}},"Show Optimization Candidates")},w.a.createElement(_.a.Header,null,"Optimization Candidates",w.a.createElement("span",{style:{float:"right"}},w.a.createElement(se.a,{style:{borderRadius:"6px",border:"1px solid #000000",display:"inline-block",fontSize:"15px",fontWeight:"bold",padding:"6px 24px",textDecoration:"none",cursor:"pointer"},data:t},"Export Data"))),w.a.createElement(_.a.Content,{style:{backgroundColor:"black"}},w.a.createElement(q.a,{inverted:!0,striped:!0,sortable:!0,size:"small"},w.a.createElement(q.a.Header,null,w.a.createElement(q.a.Row,null,w.a.createElement(q.a.HeaderCell,{sorted:"hostname"===this.state.column?this.state.direction:null,onClick:function(){return e.handleTableSort("hostname")}},"host"),w.a.createElement(q.a.HeaderCell,{sorted:"maxCpuPercent"===this.state.column?this.state.direction:null,onClick:function(){return e.handleTableSort("maxCpuPercent")}},"maxCpuPercent"),w.a.createElement(q.a.HeaderCell,{sorted:"maxMemoryPercent"===this.state.column?this.state.direction:null,onClick:function(){return e.handleTableSort("maxMemoryPercent")}},"maxMemoryPercent"),w.a.createElement(q.a.HeaderCell,{sorted:"transmitBytesPerSecond"===this.state.column?this.state.direction:null,onClick:function(){return e.handleTableSort("transmitBytesPerSecond")}},"maxTransmitBytes/s"),w.a.createElement(q.a.HeaderCell,{sorted:"receiveBytesPerSecond"===this.state.column?this.state.direction:null,onClick:function(){return e.handleTableSort("receiveBytesPerSecond")}},"maxReceiveBytes/s"),w.a.createElement(q.a.HeaderCell,{sorted:"numCpu"===this.state.column?this.state.direction:null,onClick:function(){return e.handleTableSort("numCpu")}},"numCpu"),w.a.createElement(q.a.HeaderCell,{sorted:"memGB"===this.state.column?this.state.direction:null,onClick:function(){return e.handleTableSort("memGB")}},"memGB"),w.a.createElement(q.a.HeaderCell,{sorted:"instanceType"===this.state.column?this.state.direction:null,onClick:function(){return e.handleTableSort("instanceType")}},"instanceType"),w.a.createElement(q.a.HeaderCell,{sorted:"awsPrice1"===this.state.column?this.state.direction:null,onClick:function(){return e.handleTableSort("awsPrice1")}},"price /m"),w.a.createElement(q.a.HeaderCell,{sorted:"suggestedInstanceType"===this.state.column?this.state.direction:null,onClick:function(){return e.handleTableSort("suggestedInstanceType")}},"suggestedInstanceType"),w.a.createElement(q.a.HeaderCell,{sorted:"awsPrice2"===this.state.column?this.state.direction:null,onClick:function(){return e.handleTableSort("awsPrice2")}},"suggested price /m"),w.a.createElement(q.a.HeaderCell,{sorted:"saving"===this.state.column?this.state.direction:null,onClick:function(){return e.handleTableSort("saving")}},"saving /m"))),w.a.createElement(q.a.Body,null,this.state.modalInstanceData.map(function(t,n){if(t.suggestion&&t.saving>0){var a=t.suggestions&&t.suggestions.all?j()(t.suggestions.all):[];a.shift();var r="https://one.newrelic.com/redirect/entity/"+t.entityGuid;return w.a.createElement(q.a.Row,{key:n,active:"stale"==t.suggestedInstanceType},w.a.createElement(q.a.Cell,null,w.a.createElement("a",{style:{color:"stale"==t.suggestedInstanceType?"black":"white"},href:r,rel:"noopener noreferrer",target:"_blank"},t.hostname," ",w.a.createElement(L.a,{name:"external alternate"}))),w.a.createElement(q.a.Cell,null,t.maxCpuPercent.toFixed(2)),w.a.createElement(q.a.Cell,null,t.maxMemoryPercent.toFixed(2)),w.a.createElement(q.a.Cell,null,t.transmitBytesPerSecond.toFixed(2)),w.a.createElement(q.a.Cell,null,t.receiveBytesPerSecond.toFixed(2)),w.a.createElement(q.a.Cell,null,t.numCpu),w.a.createElement(q.a.Cell,null,t.memGB),w.a.createElement(q.a.Cell,null,t.instanceType),w.a.createElement(q.a.Cell,null,(720*t.awsPrice1).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")),w.a.createElement(q.a.Cell,{style:{textAlign:"center"}},a.length>0?e.renderSuggestionsModal(t.suggestedInstanceType,a):t.suggestedInstanceType),w.a.createElement(q.a.Cell,null,(720*t.awsPrice2).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")),w.a.createElement(q.a.Cell,null,(720*t.saving).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")))}})))))}}]),t}(w.a.Component),ce=function(e){function t(e){var n;return l()(this,t),(n=m()(this,h()(t).call(this,e))).state={configMatch:!0},n.readSnapshots=n.readSnapshots.bind(f()(n)),n.writeSnapshot=n.writeSnapshot.bind(f()(n)),n}var n;return v()(t,e),u()(t,[{key:"writeSnapshot",value:(n=s()(r.a.mark(function e(t,n){var a;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={t:(new Date).getTime(),c:n,g:t.group,noc:t.nonOptimizedCost,oc:t.optimizedCost,s:t.saving,noi:t.nonOptimizedCount,oi:t.optimizedCount},e.next=3,R("cloudOptimizeSnapshotsX","ss_".concat(a.t),a);case 3:this.props.fetchSnapshots();case 4:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"readSnapshots",value:function(e){var t=this;return this.props.snapshots.filter(function(t){return e==t.document.g}).map(function(e){return e.document.configMatch=JSON.stringify(t.props.config)==JSON.stringify(e.document.c),e.document})}},{key:"writeSnapshotButton",value:function(){var e=this;return w.a.createElement(V.a,{icon:"camera",content:"Snapshot",style:{backgroundColor:"white",color:"black",borderRadius:"6px",border:"1px solid #000000",fontSize:"15px",fontWeight:"bold",display:"inline-block",float:"right",padding:"6px 24px",textDecoration:"none",cursor:"pointer"},onClick:function(){e.writeSnapshot(e.props.data,e.props.config)}})}},{key:"configDifferWarningButton",value:function(e){return e.length>0&&e[0].t&&!e[0].configMatch?w.a.createElement(_.a,{inverted:!0,trigger:w.a.createElement(V.a,{icon:"warning",content:"Config Differs from Last Snapshot",style:{backgroundColor:"white",color:"black",borderRadius:"6px",border:"1px solid #000000",fontSize:"15px",fontWeight:"bold",display:"inline-block",float:"right",padding:"6px 24px",textDecoration:"none",cursor:"pointer"}})},w.a.createElement(_.a.Header,null,"Snapshot Alert"),w.a.createElement(_.a.Content,{style:{backgroundColor:"black",color:"white"}},w.a.createElement("span",null,"We thought we'd let you know your current optimization config differs. ",w.a.createElement("br",null),"Here they are below. If you're fine with this feel free to ignore."),w.a.createElement(q.a,{inverted:!0},w.a.createElement(q.a.Header,null,w.a.createElement(q.a.Row,null,w.a.createElement(q.a.HeaderCell,null,"Current Config"),w.a.createElement(q.a.HeaderCell,null,"Last Snapshot Config"))),w.a.createElement(q.a.Body,null,w.a.createElement(q.a.Row,null,w.a.createElement(q.a.Cell,null,w.a.createElement("div",null,w.a.createElement("pre",null,JSON.stringify(this.props.config,null,2)))),w.a.createElement(q.a.Cell,null,w.a.createElement("div",null,w.a.createElement("pre",null,JSON.stringify(e[0].c,null,2))))))))):""}},{key:"render",value:function(){var e=this,t=this.readSnapshots(this.props.data.group);return w.a.createElement(_.a,{size:"fullscreen",trigger:w.a.createElement(L.a,{name:"clone"})},w.a.createElement(_.a.Header,null,"Snapshots (",t.length,") - ",this.props.data.group,this.writeSnapshotButton(),this.configDifferWarningButton(t)),w.a.createElement(_.a.Content,{scrolling:!0,style:{backgroundColor:"black"}},w.a.createElement("div",{style:{overflow:"scroll"}},w.a.createElement("div",{style:{position:"absolute"}},w.a.createElement(J,{data:this.props.data,fetchSnapshots:this.props.fetchSnapshots,cloudOptimizeSnapshots:this.props.cloudOptimizeSnapshots})),w.a.createElement("div",{style:{display:"flex",paddingLeft:"415px"}},t.map(function(t,n){return w.a.createElement(J,{key:n,data:t,fetchSnapshots:e.props.fetchSnapshots,cloudOptimizeSnapshots:e.props.cloudOptimizeSnapshots})})))))}}]),t}(w.a.Component),ue=function(e){function t(){return l()(this,t),m()(this,h()(t).apply(this,arguments))}return v()(t,e),u()(t,[{key:"render",value:function(){var e=this;return w.a.createElement("div",{style:{textAlign:"center"}},w.a.createElement(re.a.Group,{style:{margin:"auto",width:"100%"},centered:!0},this.props.sorted.map(function(t,n){var a=t.group;if("apmApplicationNames"==e.props.config.groupBy){var r=t.group?t.group.split("|").filter(Boolean):"uncategorized";a=r.map(function(e,t){return t+1==r.length?e:e+", "})}return a="null"!=a&&a?a:"uncategorized","accountName"==(e.props.config.groupBy||e.props.groupByDefault)&&(a=w.a.createElement("a",{style:{color:"white"},href:"https://rpm.newrelic.com/accounts/".concat(t.instances[0].accountId),rel:"noopener noreferrer",target:"_blank"},a," ",w.a.createElement(L.a,{name:"external alternate"}))),w.a.createElement(re.a,{key:n,style:{marginBottom:"1px",width:"400px",backgroundColor:"rgb(51, 51, 51)"},color:"green"},w.a.createElement(re.a.Content,{style:{color:"white"}},w.a.createElement("span",{style:{fontWeight:"bold",fontSize:"13px"}},a),w.a.createElement("span",{style:{float:"right"}},w.a.createElement(ce,{fetchSnapshots:e.props.fetchSnapshots,config:e.props.config,data:t,snapshots:e.props.snapshots,cloudOptimizeSnapshots:e.props.cloudOptimizeSnapshots}))),w.a.createElement(re.a.Content,null,w.a.createElement(q.a,{celled:!0,inverted:!0},w.a.createElement(q.a.Header,null,w.a.createElement(q.a.Row,null,w.a.createElement(q.a.HeaderCell,null),w.a.createElement(q.a.HeaderCell,null,"Monthly"),w.a.createElement(q.a.HeaderCell,null,"Yearly"))),w.a.createElement(q.a.Body,null,w.a.createElement(q.a.Row,null,w.a.createElement(q.a.Cell,null,"Non-Optimized"),w.a.createElement(q.a.Cell,null,"$",(720*t.nonOptimizedCost).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")),w.a.createElement(q.a.Cell,null,"$",(720*t.nonOptimizedCost*12).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,"))),w.a.createElement(q.a.Row,null,w.a.createElement(q.a.Cell,null,"Optimized"),w.a.createElement(q.a.Cell,null,"$",(720*t.optimizedCost).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")),w.a.createElement(q.a.Cell,null,"$",(720*t.optimizedCost*12).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,"))),w.a.createElement(q.a.Row,null,w.a.createElement(q.a.Cell,{positive:!0},"Saving"),w.a.createElement(q.a.Cell,{positive:!0},"$",(720*t.saving).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")),w.a.createElement(q.a.Cell,{positive:!0},"$",(720*t.saving*12).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")))),w.a.createElement(q.a.Footer,null,w.a.createElement(q.a.Row,null,w.a.createElement(q.a.HeaderCell,{style:{textAlign:"right"},colSpan:3},t.nonOptimizedCount," of ",t.totalInstances," Instances to Optimize | ",t.nonOptimizedCost>0?(Math.abs(t.saving)/t.nonOptimizedCost*100).toFixed(2):0,"% Cost Saving"))))),w.a.createElement(re.a.Content,null,w.a.createElement(le,{instances:t.instances})))})))}}]),t}(w.a.Component);function pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}n.d(t,"default",function(){return de});var me=n(438),de=function(e){function t(e){var n;return l()(this,t),(n=m()(this,h()(t).call(this,e))).state={enableNerdLog:!1,accounts:[],instanceData:[],snapshots:[],awsPricing:null,awsPricingRegionDefault:"ap-southeast-2",groupByDefault:"accountName",sortByDefault:"nonOptimizedCost",sorted:[],sort:"desc",totals:{optimizedCost:0,nonOptimizedCost:0,saving:0,optimizedCount:0,nonOptimizedCount:0},config:{optimizeBy:50,groupBy:"",sortBy:"",awsPricingRegion:"",sort:"desc",discountMultiplier:1,lastReportPeriod:24,staleInstanceCpu:5,staleInstanceMem:5,staleReceiveBytesPerSecond:0,staleTransmitBytesPerSecond:0,rightSizeCpu:.5,rightSizeMem:.5,instanceOptionsCurrent:[],instanceOptions:[]}},n.handleParentState=n.handleParentState.bind(f()(n)),n.fetchSnapshots=n.fetchSnapshots.bind(f()(n)),n}var n,a,i,o,c;return v()(t,e),u()(t,[{key:"nerdLog",value:function(e){this.state.enableNerdLog&&console.warn(e)}},{key:"handleParentState",value:function(e,t,n){switch("config"==e&&R("cloudOptimizeCfgx","main",t),this.setState(C()({},e,t)),n){case"groupAndSort":this.groupAndSort(null,"",null);break;case"groupAndSortRecalc":this.groupAndSort(null,"recalc",null)}}},{key:"componentDidMount",value:(c=s()(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({loading:!0}),this.fetchNewRelicData(),this.setState({loading:!1});case 3:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)})},{key:"fetchSnapshots",value:(o=s()(r.a.mark(function e(){var t;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F("cloudOptimizeSnapshotsX");case 2:t=e.sent,this.setState({snapshots:t.reverse()});case 4:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"handleUserConfig",value:(i=s()(r.a.mark(function e(){var t;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.nerdLog("fetching newrelic user config from nerdstore"),e.next=3,F("cloudOptimizeCfgx");case 3:if(1!==(t=e.sent).length||"main"!=t[0].id){e.next=9;break}this.nerdLog("loading existing config"),this.setState({config:t[0].document}),e.next=12;break;case 9:return this.nerdLog("writing default config"),e.next=12,R("cloudOptimizeCfgx","main",this.state.config);case 12:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"fetchAccounts",value:(a=s()(r.a.mark(function e(){var t,n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.nerdLog("fetching newrelic accounts"),e.next=3,P.NerdGraphQuery.query({query:D});case 3:return t=e.sent,n=(((t||{}).data||{}).actor||{}).accounts||[],this.setState({accounts:n}),e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"fetchNewRelicData",value:(n=s()(r.a.mark(function e(){var t;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.handleUserConfig(),e.next=3,this.fetchAccounts();case 3:if(!((t=e.sent).length>0)){e.next=8;break}return e.next=7,this.fetchAwsPricing(this.state.awsPricingRegionDefault);case 7:this.fetchSamples(t);case 8:this.fetchSnapshots();case 9:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"fetchSamples",value:function(e){var t=this,n=[],a=this.state.config;e.forEach(function(){var e=s()(r.a.mark(function e(i){var s,o,l;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.NerdGraphQuery.query({query:(r=i.id,T()(B(),r))});case 2:(s=e.sent).errors?t.nerdLog(s.errors):(o=(((((s||{}).data||{}).actor||{}).account||{}).system||{}).results||[],l=(((((s||{}).data||{}).actor||{}).account||{}).network||{}).results||[],o.forEach(function(e,r){o[r].timeSinceLastReported=(new Date).getTime()-o[r].timestamp,o[r].hostname=e.facet[0],o[r].apmApplicationNames=e.facet[1],o[r].entityGuid=e.facet[2],o[r].awsRegion=e.facet[3],o[r].apps=e.facet[1]?e.facet[1].split("|").filter(Boolean):[],o[r].memGB=Math.round(e.memTotalBytes/1024/1024/1024),o[r].numCpu=parseFloat(e.numCpu),o[r].awsInstanceType=e.ec2InstanceType,o[r].receiveBytesPerSecond=0,o[r].transmitBytesPerSecond=0;for(var s=0;s<l.length;s++)if(o[r].entityGuid==l[s].facet[1]){o[r].receiveBytesPerSecond=l[s].receiveBytesPerSecond,o[r].transmitBytesPerSecond=l[s].transmitBytesPerSecond;break}if(o[r].awsPrice1=t.pluckAwsPrice(e.ec2InstanceType||e.instanceType,e.operatingSystem)*a.discountMultiplier,o[r].suggestions=me.determineAwsInstance(t.state.config,t.state.awsPricing,o[r]),o[r].suggestions){var c=o[r].suggestions.suggested;o[r].suggestedInstanceType=c.instanceType,o[r].awsPrice2=parseFloat(c.price)*a.discountMultiplier,o[r].saving=o[r].awsPrice1-o[r].awsPrice2}o[r].accountId=i.id,o[r].accountName=i.name,n.push(o[r])}),t.setState({instanceData:n}),t.groupAndSort(n,"",""));case 4:case"end":return e.stop()}var r},e)}));return function(t){return e.apply(this,arguments)}}())}},{key:"groupAndSort",value:function(e,t,n){var a=this,r=e||this.state.instanceData,i=this.state.config,s=("groupBy"==t?n:null)||i.groupBy||this.state.groupByDefault,o=("sortBy"==t?n:null)||i.sortBy||this.state.sortByDefault;"awsPricingRegion"!=t&&"recalc"!=t||r.forEach(function(e,t){if(r[t].awsPrice1=a.pluckAwsPrice(e.ec2InstanceType||e.instanceType,e.operatingSystem)*i.discountMultiplier,r[t].suggestions=me.determineAwsInstance(a.state.config,a.state.awsPricing,r[t]),r[t].suggestions){var n=r[t].suggestions.suggested;r[t].suggestedInstanceType=n.instanceType,r[t].awsPrice2=parseFloat(n.price)*i.discountMultiplier,r[t].saving=r[t].awsPrice1-r[t].awsPrice2}else r[t].awsPrice2=0,r[t].saving=0});var l={optimizedCost:0,nonOptimizedCost:0,saving:0,optimizedCount:0,nonOptimizedCount:0},c=X()(r).groupBy(function(e){return e[s]}).map(function(e,t){var n={optimizedCost:0,nonOptimizedCost:0,saving:0,optimizedCount:0,nonOptimizedCount:0,totalInstances:e.length};return e.forEach(function(e){e.saving>0&&"stale"==e.instanceType?(n.optimizedCost+=e.awsPrice2,n.nonOptimizedCost+=e.awsPrice1,n.saving+=e.saving,n.nonOptimizedCount++,l.optimizedCost+=e.awsPrice2,l.nonOptimizedCost+=e.awsPrice1,l.saving+=e.saving,l.nonOptimizedCount++):e.saving>0&&(e.maxCpuPercent<i.optimizeBy||e.maxMemoryPercent<i.optimizeBy)?(n.optimizedCost+=e.awsPrice2,n.nonOptimizedCost+=e.awsPrice1,n.saving+=e.saving,n.nonOptimizedCount++,l.optimizedCost+=e.awsPrice2,l.nonOptimizedCost+=e.awsPrice1,l.saving+=e.saving,l.nonOptimizedCount++,e.maxCpuPercent<i.optimizeBy&&e.maxMemoryPercent<i.optimizeBy?e.suggestion="CPU & Memory Optimize":e.maxCpuPercent<i.optimizeBy?e.suggestion="Memory Optimize":e.maxMemoryPercent<i.optimizeBy&&(e.suggestion="CPU Optimize")):(n.optimizedCount++,l.optimizedCount++)}),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pe(n,!0).forEach(function(t){C()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pe(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({group:t,instances:e},n)}).value(),u="asc"==this.state.sort?X.a.sortBy(c,o):X.a.sortBy(c,o).reverse();this.setState({sorted:u,totals:l,data:r})}},{key:"pluckAwsPrice",value:function(e,t){for(var n=0;n<this.state.awsPricing.prices.length;n++)if("NA"==this.state.awsPricing.prices[n].attributes["aws:ec2:preInstalledSw"]&&this.state.awsPricing.prices[n].attributes["aws:ec2:instanceType"]==e&&this.state.awsPricing.prices[n].attributes["aws:ec2:operatingSystem"].toLowerCase()==t.toLowerCase())return parseFloat(this.state.awsPricing.prices[n].price.USD);return this.nerdLog("unable to get aws price for ".concat(e," : ").concat(t)),0}},{key:"fetchAwsPricing",value:function(e){var t=this;return new Promise(function(n){t.nerdLog("fetching aws ec2 pricing: ".concat(e)),fetch("https://yzl85kz129.execute-api.us-east-1.amazonaws.com/dev?url=https://a0.p.awsstatic.com/pricing/1.0/ec2/region/".concat(e,"/ondemand/linux/index.json")).then(function(e){return e.json()}).then(function(e){t.setState({awsPricing:e}),n()})})}},{key:"render",value:function(){return w.a.createElement("div",{style:{height:"5000%",paddingTop:"5px",paddingLeft:"5px",backgroundColor:"black"}},w.a.createElement(ae,{title:"YEARLY ",multiplier:8640,totals:this.state.totals,loading:this.state.loading}),w.a.createElement(Z,{handleParentState:this.handleParentState,config:this.state.config,instanceLength:this.state.sorted.length,fetchAwsPricing:this.fetchAwsPricing,fetchSnapshots:this.fetchSnapshots,snapshots:this.state.snapshots}),w.a.createElement(ue,{config:this.state.config,sorted:this.state.sorted,groupByDefault:this.state.groupByDefault,handleParentState:this.handleParentState,fetchSnapshots:this.fetchSnapshots,snapshots:this.state.snapshots}))}}]),t}(w.a.Component);C()(de,"propTypes",{nerdletUrlState:x.a.object,launcherUrlState:x.a.object,width:x.a.number,height:x.a.number})},44:function(e,t){e.exports=__NR1_EXTERNAL_LIB__},86:function(e,t){e.exports=ReactDOM}});
//# sourceMappingURL=07764337-da60-4155-976e-36da70372591--cloud-optimize-nerdlet.js.map